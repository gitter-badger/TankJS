<!DOCTYPE html>

<html>
<head>
  <title>Engine.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Component.html">
                Component.js
              </a>
            
              
              <a class="source" href="ComponentDef.html">
                ComponentDef.js
              </a>
            
              
              <a class="source" href="Engine.html">
                Engine.js
              </a>
            
              
              <a class="source" href="Entity.html">
                Entity.js
              </a>
            
              
              <a class="source" href="Events.html">
                Events.js
              </a>
            
              
              <a class="source" href="Keys.html">
                Keys.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>Engine.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>The MIT License (MIT)</p>
<p>Copyright (c) 2013 David Evans</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the “Software”), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="tank">TANK</h2>
<p>The main namespace from which all the features of the engine
are accessed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(TANK)</span>
{</span>
<span class="hljs-pi">  "use strict"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="create-the-engine">Create the engine</h2>
<p>Creates the main engine Entity that receives the
animation frame callback when <code>TANK.start()</code> is called.
In a simple project, systems would be attached to this entity,
and game objects added as direct children of it. The parameter is
passed directly to the constructor of Entity.</p>
<p><code>componentNames</code> - Either an Array of Component names or a single
string Component name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TANK.createEngine = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(componentNames)</span>
  {</span>
    TANK.main = TANK.createEntity(componentNames);
    <span class="hljs-keyword">return</span> TANK;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="start-game-loop">Start game loop</h2>
<p>Begins the main game loop using <code>requestAnimationFrame</code>.
This also initializes the main engine entity.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TANK.start = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
  {</span>
    TANK.main.initialize();
    _running = <span class="hljs-literal">true</span>;
    update();
    <span class="hljs-keyword">return</span> TANK;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="stop-game-loop">Stop game loop</h2>
<p>Sets a flag to not request another animation frame at
the end of the next update loop. Note that this is different
than pausing an individual entity, as it actually stops the
request animation frame loop, whereas pausing simply skips the
relevant entity’s update call.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TANK.stop = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
  {</span>
    _running = <span class="hljs-literal">false</span>;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="register-a-component-definition">Register a component definition</h2>
<p>This is the entry point to defining a new type of component.
This method should be used over manually instantiating a <code>ComponentDef</code>
as it performs additional logic to store the definition.
The new <code>ComponentDef</code> is returned, to enable a return value chained style of defining
components.</p>
<p><code>string componentName</code> - A string containing a valid identifier to be used as the name of the
new Component type.</p>
<p><code>return</code> - A new <code>ComponentDef</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TANK.registerComponent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(componentName)</span>
  {</span>
    <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> TANK.ComponentDef(componentName);
    TANK._registeredComponents[componentName] = c;
    <span class="hljs-keyword">return</span> c;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="create-an-entity">Create an entity</h2>
<p>Constructs a new <code>Entity</code> and adds the given components
to it.</p>
<p><code>[Array&lt;string&gt;, string] componentNames</code> - Either an Array of Component names or a single
string Component name.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  TANK.createEntity = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(componentNames)</span>
  {</span>
    <span class="hljs-keyword">var</span> e = <span class="hljs-keyword">new</span> TANK.Entity(componentNames);
    e._id = _nextId++;
    <span class="hljs-keyword">return</span> e;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h2 id="internal-update-loop">Internal update loop</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">update</span><span class="hljs-params">()</span>
  {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Get dt</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> newTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
    <span class="hljs-keyword">var</span> dt = (newTime - _lastTime) / <span class="hljs-number">1000.0</span>;
    _lastTime = newTime;
    <span class="hljs-keyword">if</span> (dt &gt; <span class="hljs-number">0.05</span>)
      dt = <span class="hljs-number">0.05</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Update main entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    TANK.main.update(dt);</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Request next frame</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (_running)
    {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Use RAF in browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> window == <span class="hljs-string">"undefined"</span>)
        setTimeout(update, <span class="hljs-number">16</span>);
      <span class="hljs-keyword">else</span>
        window.requestAnimationFrame(update);
    }
  }

  <span class="hljs-keyword">var</span> _nextId = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> _lastTime = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> _running = <span class="hljs-literal">false</span>;
  TANK._registeredComponents = {};

})(<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">"undefined"</span> ? (<span class="hljs-keyword">this</span>.TANK = <span class="hljs-keyword">this</span>.TANK || {}) : exports);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
